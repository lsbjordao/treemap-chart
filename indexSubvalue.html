<!DOCTYPE html>
<html>

<head>
    <title>Exemplo de TreeMap com D3.js</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body style="margin: 0; padding: 0;">
    <div id="container" style="width: 100vw; height: 99vh;"></div>

    <script>
        // Esquema de cores para correspondÃªncia com categorias
        var colorScheme = d3.scaleOrdinal(d3.schemeTableau10);

        d3.json('./input/data.json').then(function (data) {
            var container = d3.select("#container");
            var width = container.node().getBoundingClientRect().width;
            var height = container.node().getBoundingClientRect().height;

            var svg = container.append("svg")
                .attr("width", width)
                .attr("height", height);

            var treemap = d3.treemap()
                .size([width, height])
                .padding(1.5)
                .round(true);

            var root = d3.hierarchy({ children: data })
                .sum(d => d.totalValue)
                .sort((a, b) => b.value - a.value);

            treemap(root);

            var cell = svg.selectAll("g")
                .data(root.leaves())
                .enter().append("g")
                .attr("transform", d => `translate(${d.x0},${d.y0})`);

            // Atribuir cores com base nas categorias
            cell.append("rect")
                .attr("width", d => d.x1 - d.x0)
                .attr("height", d => d.y1 - d.y0)
                .style("fill", d => colorScheme(d.data.name))

            // Adicione barras horizontais representando parcelas
            cell.append("rect")
                .attr("width", d => d.x1 - d.x0)
                .attr("height", d => (d.y1 - d.y0) * (d.data.sliceValue / d.data.totalValue))
                .attr("y", d => (d.y1 - d.y0) - (d.y1 - d.y0) * (d.data.sliceValue / d.data.totalValue))
                .style("fill-opacity", 0.22)

            // Genero
            cell.append("text")
                .attr("x", 3)
                .attr("y", 17)
                .style("font-size", "20px")
                .style("font-style", "italic")
                .style("font-weight", "bold")
                .style("fill", "white")
                .text(d => d.data.name);

            // Valor Total
            cell.append("text")
                .attr("x", 3)
                .attr("y", 35)
                .style("font-size", "18px")
                .style("font-weight", "bold")
                .style("fill", "white")
                .text(d => d.data.totalValue)

            // Valor da Parcela
            cell.append("text")
                .attr("x", 3)
                .attr("y", d => d.y1 - d.y0 - 4)
                .style("font-size", "18px")
                .style("font-weight", "bold")
                .style("fill", "white")
                .text(d => d.data.sliceValue);
        });
    </script>
</body>

</html>